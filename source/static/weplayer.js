!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,function(){return function(i){var n={};function r(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}return r.m=i,r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=7)}([function(t,e,i){t.exports=function(){return i(6)('!function(i){var r={};function n(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}n.m=i,n.c=r,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,i){"use strict";i.r(e);var r=function(e){var i=this.constructor;return this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){return i.reject(t)})})},n=setTimeout;function a(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}function s(i,r){for(;3===i._state;)i=i._value;0!==i._state?(i._handled=!0,o._immediateFn(function(){var t=1===i._state?r.onFulfilled:r.onRejected;if(null!==t){var e;try{e=t(i._value)}catch(t){return void f(r.promise,t)}u(r.promise,e)}else(1===i._state?u:f)(r.promise,i._value)})):i._deferreds.push(r)}function u(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof o)return e._state=3,e._value=t,void d(e);if("function"==typeof i)return void c((r=i,n=t,function(){r.apply(n,arguments)}),e)}e._state=1,e._value=t,d(e)}catch(t){f(e,t)}var r,n}function f(t,e){t._state=2,t._value=e,d(t)}function d(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)s(t,t._deferreds[e]);t._deferreds=null}function h(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i}function c(t,e){var i=!1;try{t(function(t){i||(i=!0,u(e,t))},function(t){i||(i=!0,f(e,t))})}catch(t){if(i)return;i=!0,f(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var i=new this.constructor(a);return s(this,new h(t,e,i)),i},o.prototype.finally=r,o.all=function(e){return new o(function(r,n){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var a=Array.prototype.slice.call(e);if(0===a.length)return r([]);var o=a.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if("function"==typeof i)return void i.call(t,function(t){s(e,t)},n)}a[e]=t,0==--o&&r(a)}catch(t){n(t)}}for(var t=0;t<a.length;t++)s(t,a[t])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(i){return new o(function(t,e){e(i)})},o.race=function(n){return new o(function(t,e){for(var i=0,r=n.length;i<r;i++)n[i].then(t,e)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){n(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console};var p=o,l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype.finally||(l.Promise.prototype.finally=r):l.Promise=p;var m,g,y,v,b,_,w,S,A,D,x="io_error",O="demux_error",k="init_segment",L="media_segment",U="loading_complete",T="recovered_early_eof",P="media_info",C="metadata_arrived",I="scriptdata_arrived",R="statistics_info",B="recommend_seekpoint",j="error",E="seeking",M="timeupdate",F="init",z=function(){function t(t,e,i){this.header=i,this.url=t;var r=new XMLHttpRequest;r.open("get",t),r.responseType="arraybuffer",r.setRequestHeader("Range","bytes="+e[0]+"-"+e[1]),this._promise=new Promise(function(t,e){r.onload=function(){200!==r.status&&206!==r.status||t(r.response)},r.onerror=function(t){e(t)}}),this._xhr=r}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!0,configurable:!0}),t.prototype.run=function(){this._xhr.send()},t.prototype.cancel=function(){this._xhr.abort()},t}(),V=function(){return(V=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},N=function(){function t(t,e,i){void 0===i&&(i={});var r=this;this.url=t,this.on=!1,this.complete=!1,this.isStopped=!1,this.timeStamp=Date.now();var n={headers:{Range:"bytes="+e[0]+"-"+e[1]},method:"GET",cache:"default",mode:"cors"};this.request=function(){return r.on=!0,fetch(t,V({},n,i)).then(function(t){return 299<t.status||t.status<200||!t.ok?(r.complete=!0,Promise.reject(new Error("url "+t.status+" "+t.statusText))):Promise.resolve(t)}).then(function(t){return t.arrayBuffer()}).then(function(t){return r.complete=!0,r.byteLength=t.byteLength,r.isStopped?{}:{buffer:t,timeStamp:r.timeStamp}})}}return t.prototype.run=function(){this._promise=this.request()},Object.defineProperty(t.prototype,"readyState",{get:function(){return 1},enumerable:!0,configurable:!0}),t.prototype.cancel=function(){this.isStopped=!0},Object.defineProperty(t.prototype,"promise",{get:function(){return this.on?this._promise:this.request()},enumerable:!0,configurable:!0}),t}(),K=fetch?N:z,H=[],q=function(){function t(t,e,i){this.url=t,this.range=e,this.id=e.join("-"),this.on=!1,this.loader=new K(t,e,i),this.isCanceled=!1,H.push(this),this.update()}return t.prototype.cancel=function(){this.isCanceled=!0,this.loader.cancel()},t.prototype.remove=function(i){H.filter(function(t,e){return t.url===i.url&&t.id===i.id&&(H.splice(e,1),!0)}),this.update()},t.prototype.update=function(){var t=H.filter(function(t){return t.on}),e=H.filter(function(t){return!t.on}),i=2-t.length;e.forEach(function(t,e){e<i&&t.run()})},t.prototype.run=function(){1===this.loader.readyState?(this.on=!0,this.loader.run()):this.remove()},t.prototype.clear=function(){H.forEach(function(t){t.loader.complete||t.cancel()}),H.length=0},Object.defineProperty(t.prototype,"promise",{get:function(){return this.loader.promise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeStamp",{get:function(){return this.loader.timeStamp},enumerable:!0,configurable:!0}),t}(),G=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var r=0,n=0,a=e;n<a.length;n++){r+=(d=a[n]).length}for(var o=new t(r),s=0,u=0,f=e;u<f.length;u++){var d=f[u];o.set(d,s),s+=d.length}return o},Z=function(){function t(t){this.buffer=t||new Uint8Array(0)}return t.prototype.write=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];t.forEach(function(t){t&&(e.buffer=G(Uint8Array,e.buffer,t))})},t.writeUint32=function(t){return new Uint8Array([t>>24,t>>16&255,t>>8&255,255&t])},t.readAsInt=function(t){var e="";return t.forEach(function(t){e+=("00"+t.toString(16)).slice(-2)}),parseInt(e,16)},t}(),W=function(){function t(){this.mimeType=null,this.codec="",this.duration=null,this.hasAudio=!1,this.hasVideo=!1,this.audioCodec=null,this.videoCodec=null,this.videoDataRate=null,this.audioDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.audioConfig=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.chromaFormat=null,this.pixelRatio=[],this._metaData=null,this.segments=[],this.hasKeyframes=null,this.keyframes=[]}return Object.defineProperty(t.prototype,"isComplete",{get:function(){var t=this.mimeType,e=this.duration,i=this.hasKeyframes;return null!==t&&null!==e&&null!==i&&this.isVideoInfoFilled&&this.isAudioInfoFilled},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAudioInfoFilled",{get:function(){var t=this.hasAudio,e=this.audioCodec,i=this.audioSampleRate,r=this.audioChannelCount;return!(t&&!(t&&e&&i&&r))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVideoInfoFilled",{get:function(){for(var t=["videoCodec","width","height","fps","profile","level","chromaFormat"],e=0,i=t.length;e<i;e++)if(null===this[t[e]])return!1;return this.hasVideo},enumerable:!0,configurable:!0}),t}(),X=(m=new ArrayBuffer(2),new DataView(m).setInt16(0,256,!0),256===new Int16Array(m)[0]),J={get device(){var t=J.os;return t.isPc?"pc":t.isTablet?"tablet":"mobile"},get browser(){var e=navigator.userAgent.toLowerCase(),i={ie:/rv:([\\d.]+)\\) like gecko/,firfox:/firefox\\/([\\d.]+)/,chrome:/chrome\\/([\\d.]+)/,opera:/opera.([\\d.]+)/,safari:/version\\/([\\d.]+).*safari/};return[].concat(Object.keys(i).filter(function(t){return i[t].test(e)}))[0]},get os(){var t=navigator.userAgent,e=/(?:Windows Phone)/.test(t),i=/(?:SymbianOS)/.test(t)||e,r=/(?:Android)/.test(t),n=/(?:Firefox)/.test(t),a=/(?:iPad|PlayBook)/.test(t)||r&&!/(?:Mobile)/.test(t)||n&&/(?:Tablet)/.test(t),o=/(?:iPhone)/.test(t)&&!a;return{isTablet:a,isPhone:o,isAndroid:r,isPc:!o&&!r&&!i,isSymbian:i,isWindowsPhone:e,isFireFox:n}},get isLe(){return X}},Q=J,Y=function(){function t(t){this.controller=t,this.state={isLe:Q.isLe,_hasAudio:!1,_hasVideo:!1,_mediaInfo:new W,_metaData:null,_videoTrack:{type:"video",id:1,samples:[],length:0},_audioTrack:{type:"audio",id:2,samples:[],length:0},_videoMetaData:null,_audioMetaData:null,_audioInitialMetadataDispatched:!1,_videoInitialMetadataDispatched:!1,tags:[],timeStampBase:0,hasVideoFlagOverrided:!1,hasAudioFlagOverrided:!1,timeScale:1e3,duration:0,isLive:!1,durationOverrided:!1,naluLengthSize:4,_referFrameRate:{fixed:!0,fps:23.976,fpsNum:23976,fpsDen:1e3},metaEndPosition:-1}}return t.prototype.clearTags=function(){this.state.tags=[]},Object.defineProperty(t.prototype,"referFrameRate",{get:function(){return this.state._referFrameRate},set:function(t){this.state._referFrameRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mediaInfo",{get:function(){return this.state._mediaInfo},set:function(t){this.state._mediaInfo=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metaData",{get:function(){return this.state._metaData},set:function(t){this.state._metaData=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMetaData",{get:function(){return null!==this.state._metaData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioTrack",{get:function(){return this.state._audioTrack},set:function(t){this.state._audioTrack=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoTrack",{get:function(){return this.state._videoTrack},set:function(t){this.state._videoTrack=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasAudio",{get:function(){return this.state._hasAudio},set:function(t){this.state._hasAudio=t,this.state._mediaInfo.hasAudio=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasVideo",{get:function(){return this.state._hasVideo},set:function(t){this.state._hasVideo=t,this.state._mediaInfo.hasVideo=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoMetaData",{get:function(){return this.state._videoMetaData},set:function(t){this.state._videoMetaData=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioMetaData",{get:function(){return this.state._audioMetaData},set:function(t){this.state._audioMetaData=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keyframes",{get:function(){return this.state._mediaInfo.keyframes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSeekable",{get:function(){return this.state._mediaInfo.hasKeyframes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLe",{get:function(){return this.state.isLe},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasInitialMetaDispatched",{get:function(){var t=this.state,e=t._hasAudio,i=t._hasVideo,r=t._audioInitialMetadataDispatched,n=t._videoInitialMetadataDispatched;return e&&i?r&&n:e&&!i?r:!(e||!i)&&n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoTimeScale",{get:function(){return this.state.timeScale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metaEndPosition",{get:function(){return this.state.metaEndPosition},set:function(t){this.state.metaEndPosition=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLive",{get:function(){return this.state.isLive},set:function(t){this.state.isLive=t},enumerable:!0,configurable:!0}),t}(),$=function(){function t(){this.tagType=-1,this.bodySize=-1,this.tagSize=-1,this.position=-1,this.Timestamp=-1,this.StreamID=-1,this.body=-1,this.time=-1,this.arr=[]}return t.prototype.getTime=function(){this.arr=[];for(var t=0;t<this.Timestamp.length;t++)this.arr.push(1===this.Timestamp[t].toString(16).length?"0"+this.Timestamp[t].toString(16):this.Timestamp[t].toString(16));this.arr.pop();var e=this.arr.join("");return this.time=parseInt(e,16),parseInt(e,16)},t}(),tt=function(){function i(t){this.CLASS_NAME=this.constructor.name,this.store=t,this.temp_u8a=null,this.dataLen=0,this.stop=!1,this.index=0,this.offset=0,this.filePosition=0,this.firstFlag=!0}return i.prototype.seek=function(){this.offset=0},i.prototype.destroy=function(){this.temp_u8a=null,this.dataLen=0,this.stop=!1,this.index=0,this.offset=0,this.filePosition=0},i.prototype.setFlv=function(t){this.stop=!1,this.index=0,this.offset=0;var e=this.temp_u8a=t;return this.dataLen=this.temp_u8a.length,this.firstFlag?(13<e.length&&i.isFlvHead(e)&&(this.parseHead(),this.readData(9),this.readData(4),this.parseData(),this.firstFlag=!1,this.filePosition+=this.offset),this.offset):this.parseData()},i.prototype.parseData=function(){for(var t=this.temp_u8a.length;this.index<t&&!this.stop;){this.offset=this.index;var e=new $;if(11<=this.unreadLength)if(e.position=this.filePosition+this.offset,e.tagType=this.readData(1)[0],e.bodySize=this.readData(3),e.Timestamp=this.readData(4),e.StreamID=this.readData(3),this.unreadLength>=this.getBodySize(e.bodySize)+4){e.body=this.readData(this.getBodySize(e.bodySize)),e.tagSize=this.readData(4);var i=this.store.state,r=i.tags,n=i._hasVideo,a=i._hasAudio;switch(e.tagType){case 9:n&&r.push(e);break;case 8:a&&r.push(e);break;case 18:r.push(e)}this.offset=this.index}else this.stop=!0;else this.stop=!0}return this.filePosition+=this.offset,this.temp_u8a=null,this.offset},i.prototype.getBodySize=function(t){return Z.readAsInt(t)},i.prototype.parseHead=function(){var t=this.temp_u8a,e=this.store,i={match:!1};if(1!==t[3])return i;var r=t[4],n=(4&r)>>>2!=0,a=0!=(1&r);if(!n&&!a)return i;e.hasAudio=n,e.hasVideo=a},i.prototype.readData=function(t){var e=this.index;return this.index+=t,this.temp_u8a.slice(e,e+t)},Object.defineProperty(i.prototype,"unreadLength",{get:function(){return this.dataLen-this.index},enumerable:!0,configurable:!0}),i.isFlvHead=function(t){var e=[t[0],t[1],t[2]];return"FLV"===String.fromCharCode.apply(String,e)},i}(),et=function(){function t(){this.__eeOnce__={},this.__ee__={}}return t.prototype.on=function(t,e){return this.addEvents(this.__ee__,t,e),this},t.prototype.once=function(t,e){this.addEvents(this.__eeOnce__,t,e)},t.prototype.off=function(i,r){var n=this,a=this.__ee__[i],o=this.__eeOnce__[i];return a&&0<a.length&&a.forEach(function(t,e){t===r&&(n.__ee__[i]=a.splice(e,1))}),o&&0<o.length&&o.forEach(function(t,e){t===r&&(n.__eeOnce__[i]=o.splice(e,1))}),this},t.prototype.emit=function(i){for(var r=this,n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var e=this.__ee__[i],a=this.__eeOnce__[i];e&&0<e.length&&e.forEach(function(t){"function"==typeof t&&t.apply(void 0,n)}),a&&0<a.length&&a.forEach(function(t,e){"function"==typeof t&&(t.apply(void 0,n),r.__eeOnce__[i]=a.splice(e,1))})},t.prototype.destroy=function(){this.__ee__={},this.__eeOnce__={}},t.prototype.addEvents=function(t,e,i){t[e]?t[e].push(i):t[e]=[i]},t}(),it={network:{code:1,msg:"视频下载错误",remark:"只要视频下载错误就使用此类型，无论是video本身的超时还是xhr的分段请求超时或者资源不存在"},mse:{code:2,msg:"流追加错误",remark:"追加流的时候如果类型不对、无法被正确解码则会触发此类错误"},parse:{code:3,msg:"解析错误",remark:"mp4、hls、flv我们都是使用js进行格式解析，如果解析失败则会触发此类错误"},format:{code:4,msg:"格式错误",remark:"如果浏览器不支持的格式导致播放错误"},decoder:{code:5,msg:"解码错误",remark:"浏览器解码异常会抛出此类型错误"},runtime:{code:6,msg:"语法错误",remark:"播放器语法错误"},timeout:{code:7,msg:"播放超时",remark:"播放过程中无法正常请求下一个分段导致播放中断"},other:{code:8,msg:"其他错误",remark:"不可知的错误或被忽略的错误类型"}},rt=function(t,e,i,r,n,a){void 0===a&&(a={line:"",handle:"",msg:"",version:""});var o={};return o.playerVersion=a.version,o.errorType=t,o.domain=document.domain,o.duration=e,o.networkState=i,o.readyState=r,o.src=n,o.errd=a,o.ex=(it[t]||{}).msg,o},nt=(g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),at=function(r){function t(t,e){void 0===e&&(e="muxer");var i=r.call(this)||this;return t&&(i.store=t),i.name=e,i}return nt(t,r),t.prototype.emitError=function(t,e){void 0===e&&(e={line:"",handle:"",msg:"",version:""});var i=this.store,r=i.controller,n=i.state;if(r){var a=new rt(t,n.duration,"",!0,r.config.url,e);r.emit("error",a)}},t.prototype.dispatch=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.emit.apply(this,[this.name+"_"+t].concat(e))},t.prototype.error=function(t){},t.prototype.info=function(t){},t.prototype.log=function(t){},t.prototype.warn=function(t){},t}(et),ot=0,st=1,ut=2,ft=3,dt=8,ht=9,ct=10,pt=11,lt=12,mt="error",gt=[5500,11e3,22e3,4400],yt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3],vt="firefox",bt=function(){function o(){}return o.decode=function(t){for(var e=[],i=t,r=0,n=t.length;r<n;)if(i[r]<128)e.push(String.fromCharCode(i[r])),++r;else{if(i[r]<192);else if(i[r]<224){if(o._checkContinuation(i,r,1))if(128<=(a=(31&i[r])<<6|63&i[r+1])){e.push(String.fromCharCode(65535&a)),r+=2;continue}}else if(i[r]<240){if(o._checkContinuation(i,r,2))if(2048<=(a=(15&i[r])<<12|(63&i[r+1])<<6|63&i[r+2])&&55296!=(63488&a)){e.push(String.fromCharCode(65535&a)),r+=3;continue}}else if(i[r]<248){var a;if(o._checkContinuation(i,r,3))if(65536<(a=(7&i[r])<<18|(63&i[r+1])<<12|(63&i[r+2])<<6|63&i[r+3])&&a<1114112){a-=65536,e.push(String.fromCharCode(a>>>10|55296)),e.push(String.fromCharCode(1023&a|56320)),r+=4;continue}}e.push(String.fromCharCode(65533)),++r}return e.join("")},o._checkContinuation=function(t,e,i){var r=t,n=i;if(e+n<r.length){for(;n--;)if(128!=(192&r[++e]))return!1;return!0}return!1},o}(),_t=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),wt=ot,St=st,At=ut,Dt=ft,xt=dt,Ot=ht,kt=ct,Lt=pt,Ut=lt,Tt=function(i){function t(t){var e=i.call(this,t)||this;return e.offset=0,e.readOffset=e.offset,e}return _t(t,i),Object.defineProperty(t.prototype,"isLe",{get:function(){return this.store.isLe},enumerable:!0,configurable:!0}),t.prototype.resolve=function(t,e){var i={},r=this.parseValue(t,e),n=this.parseValue(t,e-r.bodySize);return i[r.data]=n.data,this.resetStatus(),i},t.prototype.resetStatus=function(){this.offset=0,this.readOffset=this.offset},t.prototype.parseString=function(t){var e=new DataView(t,this.readOffset).getUint16(0,!this.isLe),i="";i=0<e?bt.decode(new Uint8Array(t,this.readOffset+2,e)):"";var r=e+2;return this.readOffset+=r,{data:i,bodySize:e+2}},t.prototype.parseDate=function(t,e){var i=this.isLe,r=new DataView(t,this.readOffset,e),n=r.getFloat64(0,!i);return n+=60*r.getInt16(8,!i)*1e3,this.readOffset+=10,{data:new Date(n),bodySize:10}},t.prototype.parseObject=function(t,e){var i=this.parseString(t),r=this.parseValue(t,e-i.bodySize);return{data:{name:i.data,value:r.data},bodySize:i.bodySize+r.bodySize,isObjEnd:r.isObjEnd}},t.prototype.parseLongString=function(t){var e=new DataView(t,this.readOffset).getUint32(0,!this.isLe),i="";return 0<e&&(i=bt.decode(new Uint8Array(t,this.readOffset+2,e))),this.readOffset+=e+4,{data:i,bodySize:e+4}},t.prototype.parseValue=function(t,e){var i;i=t instanceof ArrayBuffer?t:t.buffer;var r=this.isLe,n=new DataView(i,this.readOffset,e),a=!1,o=n.getUint8(0),s=1;this.readOffset+=1;var u=null;switch(o){case wt:u=n.getFloat64(1,!r),this.readOffset+=8,s+=8;break;case St:u=!!n.getUint8(1),this.readOffset+=1,s+=1;break;case At:var f=this.parseString(i);u=f.data,s+=f.bodySize;break;case Dt:u={};var d=0;for(16777215&n.getUint32(e-4,!r)&&(d=3);s<e-4;){var h=this.parseObject(i,e-s-d);if(h.isObjectEnd)break;u[h.data.name]=h.data.value,s+=h.bodySize}if(s<=e-3)9===(16777215&n.getUint32(s-1,!r))&&(this.readOffset+=3,s+=3);break;case xt:u={},s+=4,this.readOffset+=4;d=0;for(9==(16777215&n.getUint32(e-4,!r))&&(d=3);s<e-8;){var c=this.parseObject(i,e-s-d);if(c.isObjectEnd)break;u[c.data.name]=c.data.value,s+=c.bodySize}if(s<=e-3)9===(16777215&n.getUint32(s-1,!r))&&(s+=3,this.readOffset+=3);break;case Ot:a=!(u=null);break;case kt:u=[];var p=n.getUint32(1,!r);s+=4,this.readOffset+=4;for(var l=0;l<p;l++){var m=this.parseValue(i,e-s);u.push(m.data),s+=m.bodySize}break;case Lt:var g=this.parseDate(i,e-1);u=g.data,s+=g.bodySize;break;case Ut:var y=this.parseLongString(i);u=y.data,s+=y.bodySize;break;default:s=e}return{isObjEnd:a,data:u,bodySize:s}},t}(at),Pt=function(){function t(t){this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,i=t.byteLength-e,r=new Uint8Array(4),n=Math.min(4,e);if(0===n)throw new Error("no bytes available");r.set(t.subarray(i,i+n)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},t.prototype.skipBits=function(t){var e,i=t;return this.bitsAvailable>i||(i-=this.bitsAvailable,i-=(e=i>>3)>>3,this.bytesAvailable-=e,this.loadWord()),this.word<<=i,this.bitsAvailable-=i,e},t.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return this.bitsAvailable-=e,0<this.bitsAvailable?this.word<<=e:0<this.bytesAvailable&&this.loadWord(),0<(e=t-e)&&this.bitsAvailable?i<<e|this.readBits(e):i},t.prototype.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.prototype.readBoolean=function(){return 1===this.readBits(1)},t.prototype.readUByte=function(){return this.readBits(8)},t.prototype.readUShort=function(){return this.readBits(16)},t.prototype.readUInt=function(){return this.readBits(32)},t.prototype.skipScalingList=function(t){var e,i=8,r=8;for(e=0;e<t;e++)0!==r&&(r=(i+this.readEG()+256)%256),i=0===r?i:r},t.prototype.readSPS=function(){var t,e,i,r,n,a,o,s,u,f,d,h=0,c=0,p=0,l=0,m=this.readUByte.bind(this),g=this.readBits.bind(this),y=this.readUEG.bind(this),v=this.readBoolean.bind(this),b=this.skipBits.bind(this),_=this.skipEG.bind(this),w=this.skipUEG.bind(this),S=this.skipScalingList.bind(this);m(),t=m(),g(5),b(3),e=m(),w();var A=1,D=420,x=8;if([100,110,122,244,44,83,86,118,128].includes(t)&&(3===(A=y())&&b(1),A<=3&&(D=[0,420,422,444][A]),x=y()+8,w(),b(1),v()))for(f=3!==A?8:12,d=0;d<f;d++)v()&&S(d<6?16:64);w();var O=y();if(0===O)y();else if(1===O)for(b(1),_(),_(),a=y(),d=0;d<a;d++)_();var k=y();b(1),o=y(),s=y(),0===(u=g(1))&&b(1),b(1),v()&&(h=y(),c=y(),p=y(),l=y());var L={fps:0,fpsFixed:!0,fpsNum:0,fpsDen:0},U=[1,1];if(v()){if(v())switch(m()){case 1:U=[1,1];break;case 2:U=[12,11];break;case 3:U=[10,11];break;case 4:U=[16,11];break;case 5:U=[40,33];break;case 6:U=[24,11];break;case 7:U=[20,11];break;case 8:U=[32,11];break;case 9:U=[80,33];break;case 10:U=[18,11];break;case 11:U=[15,11];break;case 12:U=[64,33];break;case 13:U=[160,99];break;case 14:U=[4,3];break;case 15:U=[3,2];break;case 16:U=[2,1];break;case 255:U=[m()<<8|m(),m()<<8|m()]}if(v()&&v(),v()&&(g(4),v()&&g(24)),v()&&(y(),y()),v()){var T=g(32);L.fpsNum=g(32),L.fixed=this.readBoolean(),L.fpsDen=2*T,L.fps=L.fpsNum/L.fpsDen}var P=0,C=0;if(0===A)P=1,P=2-u;else P=3===A?1:2,C=(1===A?2:1)*(2-u);i=16*(o+1),r=16*(s+1)*(2-u),i-=(h+c)*P,r-=(p+l)*C,n=(1===U[0]||1===U[1]?1:U[0]/U[1])*i}return{profileIdc:t,levelIdc:e,refFrames:k,chromaFormat:D,bitDepth:x,frameRate:L,codecSize:{width:i,height:r},presentSize:{width:n,height:r},width:Math.ceil(16*(o+1)-2*h-2*c),height:(2-u)*(s+1)*16-(u?2:4)*(p+l),pixelRatio:U}},t.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),Ct=function(){function o(){}return o.getProfileStr=function(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},o.getLevelStr=function(t){return(t/10).toFixed(1)},o.getChromaFormatStr=function(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},o.parseSPS=function(t){var e=o._ebsp2rbsp(t),i=new Pt(e).readSPS(),r=i.chromaFormat,n=i.levelIdc,a=i.profileIdc;return i.profileString=o.getProfileStr(a),i.levelString=o.getLevelStr(n),i.chromaFormatString=o.getChromaFormatStr(r),i},o._ebsp2rbsp=function(t){for(var e=t.byteLength,i=new Uint8Array(t.byteLength),r=0,n=0,a=e;n<a;n++)2<n&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(i[r++]=t[n]);return new Uint8Array(i.buffer,0,r)},o}(),It=function(){function s(t,e){this._dv=new DataView(t),this._context=e,this.isLe=!e.store.isLe,this.sizeArr=[8,16,32]}return s.prototype.getUint8=function(t){var e=t;return e||(e=this._context.readOffset),e===this._context.readOffset&&(this._context.readOffset+=1),this._dv.getUint8(e,this.isLe)},s.prototype.getUint16=function(t){var e=t;return e||(e=this._context.readOffset),e===this._context.readOffset&&(this._context.readOffset+=2),this._dv.getUint16(e,this.isLe)},s.prototype.getUint32=function(t){var e=t;return e||(e=this._context.readOffset),e===this._context.readOffset&&(this._context.readOffset+=4),this._dv.getUint32(e,this.isLe)},s.prototype.getUint24=function(t){var e=this.getUint(24,t,!1);return this._context.readOffset-=1,e},s.prototype.getUint=function(t,e,i){void 0===i&&(i=!0);var r=32;if(this["getUint"+t])return this["getUint"+r](e,this.isLe);for(var n=0,a=this.sizeArr.length;n<a;n++)if(t<this.sizeArr[n]){r=this.sizeArr[n];break}var o=i?s.getAndNum(0,t-1,r):s.getAndNum(r-t,r-1,r);return this["getUint"+r](e,this.isLe)&o},s.getAndNum=function(t,e,i){void 0===i&&(i=8);for(var r=0,n=i,a=--n;0<a;)e<a||a<t||(r+=Math.pow(2,n-a)),a--;return r},s}(),Rt=(v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Bt=function(i){function t(t){var e=i.call(this,t)||this;return e.CLASS_NAME=e.constructor.name,e.readOffset=0,e.data=new Uint8Array(0),e.currentTag=null,e.store.videoMetaData=null,e}return Rt(t,i),t.prototype.resetStatus=function(){this.readOffset=0,this.data=new Uint8Array(0),this.currentTag=null},t.prototype.resolve=function(t){this.data=t.body,this.currentTag=t;var e=this.readData(1)[0],i=(240&e)>>>4,r=15&e;7===r?(this._parseAVCPacket(i),this.resetStatus()):this.error("unsupported codecId: "+r)},t.prototype._parseAVCPacket=function(t){this.unreadLength<4&&this.error("Invalid Avc Tag");var e=this.store.isLe,i=this.data.buffer,r=new DataView(i,this.readOffset,this.unreadLength),n=r.getUint8(0),a=16777215&r.getUint32(0,!e);switch(a=a<<8>>8,this.readOffset+=4,n){case 0:var o=this.currentTag,s=o.position,u=o.tagSize;this.store.metaEndPosition=s+Z.readAsInt(u)+4,this._parseAVCDecoderConfigurationRecord();break;case 1:this._parseAVCVideoData(t,a)}},t.prototype._parseAVCDecoderConfigurationRecord=function(){if(this.unreadLength<7)this.error("Invalid AVCDecoderConfigurationRecord, lack of data!");else{var t=this.store,e=t.mediaInfo,i=t.videoMetaData,r=t.videoTrack,n=new It(this.data.buffer,this);i?void 0!==i.avcc&&this.error("found another AVCDecoderConfigurationRecord!"):(t.state._hasVideo||t.state.hasVideoFlagOverrided||(t.state._hasVideo=!0,t.mediaInfo.hasVideo=!0),(i=t.videoMetaData={}).type="video",i.id=r.id,i.timeScale=t.videoTimeScale,i.duration=t.state.duration,e.timescale=t.videoTimeScale);var a=n.getUint8(),o=n.getUint8();if(n.getUint8(),n.getUint8(),1===a&&0!==o){var s=t.state.naluLengthSize=n.getUint(2,this.readOffset,!1)+1;if(3===s||4===s){var u=n.getUint(5,null,!1);if(0!==u){var f,d;1<u&&(this.emitError("decoder",{line:132,handler:"_parseAVCDecoderConfigurationRecord",msg:"spsLength > 1"}),this.warn("AVCDecoderConfigurationRecord: spsLength > 1"));for(var h=0;h<u;h++){var c=n.getUint16();if(0!==c){f=new Uint8Array(this.data.buffer,this.readOffset,c),this.readOffset+=c;var p=Ct.parseSPS(f);if(0===h){var l=p.codecSize,m=p.presentSize,g=p.profileString,y=p.levelString,v=p.chromaFormat,b=p.pixelRatio,_=p.frameRate,w=p.refFrames,S=p.bitDepth;i.width=l.width,i.height=l.height,i.presentWidth=m.width,i.presentHeight=m.height,i.profile=g,i.level=y,i.bitDepth=S,i.chromaFormat=v,i.pixelRatio=b,(i.frameRate=_).fixed&&0!==_.fpsNum&&0!==_.fpsDen||(i.frameRate=t.referFrameRate);var A=i.frameRate,D=A.fpsDen,x=A.fpsNum;i.refSampleDuration=i.timeScale*(D/x);for(var O=f.subarray(1,4),k="avc1.",L=0;L<3;L++){var U=O[L].toString(16);k+=U=("00"+U).slice(-2)}i.codec=k,e.width=i.width,e.height=i.height,e.fps=i.frameRate.fps,e.profile=i.profile,e.level=i.level,e.refFrames=w,e.pixelRatio=b,e.videoCodec=k,e.chromaFormat=v,e.hasAudio?e.audioCodec&&(e.mimeType=\'video/x-flv codecs="\'+e.videoCodec+","+e.audioCodec+\'"\',e.codec=e.mimeType.replace("x-flv","mp4")):(e.mimeType=\'video/x-flv codecs="\'+e.videoCodec+\'"\',e.codec=e.mimeType.replace("x-flv","mp4"))}}}var T=n.getUint8();if(!T)return this.emitError("decoder",{line:227,handler:"_parseAVCDecoderConfigurationRecord",msg:"no pps in this video"}),void this.dispatch(j,"no pps in this video");1<T&&this.warn("AVCDecoderConfigurationRecord has ppsCount: "+T);for(h=0;h<T;h++){var P=n.getUint16();P&&(d=new Uint8Array(this.data.buffer,this.readOffset,P),this.readOffset+=P)}e.sps=i.sps=f,e.pps=i.pps=d,e.isComplete&&this.mediaInfoReady(e),t.hasInitialMetaDispatched?(t.videoTrack.length||t.audioTrack.length)&&this.dataReady(t.videoTrack,t.audioTrack):t.state._videoInitialMetadataDispatched=!0,this.metaDataReady("video",i)}else this.emitError("decoder",{line:128,handler:"_parseAVCDecoderConfigurationRecord",msg:"no sps in this video"})}}}},t.prototype._parseAVCVideoData=function(t,e){for(var i=new It(this.data.buffer,this),r=[],n=0,a=this.store.state.naluLengthSize,o=this.store.state.timeStampBase+this.currentTag.getTime(),s=1===t;0<this.unreadLength;){if(this.unreadLength<4){this.warn("not enough data for parsing AVC");break}var u=this.readOffset,f=4===a?i.getUint32():i.getUint24();if(f>this.unreadLength)return;var d=i.getUint(5,this.readOffset,!1);5===d&&(s=!0);var h=new Uint8Array(this.data.buffer,u,a+f);this.readOffset=u+a+f;var c={type:d,data:h};r.push(c),n+=h.byteLength}if(i=null,r.length){var p=this.store.videoTrack,l={units:r,length:n,dts:o,cps:e,pts:o+e,isKeyframe:s,position:s?this.currentTag.position:void 0};p.samples.push(l),p.length+=n}},t.prototype.readData=function(t){var e=this.data,i=this.readOffset;return this.dataSize>i+t?(this.readOffset+=t,e.slice(i,t)):[]},Object.defineProperty(t.prototype,"dataSize",{get:function(){return this.data.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unreadLength",{get:function(){return this.dataSize-this.readOffset},enumerable:!0,configurable:!0}),t}(at),jt=(b=function(t,e){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}b(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Et=function(i){function t(t){var e=i.call(this,t)||this;return e.CLASS_NAME=e.constructor.name,e.currentTag=null,e.data=new Uint8Array(0),e.readOffset=0,e.store.audioMetaData=null,e}return jt(t,i),t.prototype.resolve=function(t){this.readOffset=0;var e=this.store,i=e.audioTrack;this.currentTag=t,this.data=t.body;var r=e.audioMetaData;r||(r=e.audioMetaData={},e.audioMetaData=this.initAudioMeta(r));var n=new It(t.body.buffer,this).getUint8(),a=n>>>4,o=(12&n)>>>2,s=n%1;if(r.audioSampleRate=gt[o],r.channelCount=0===s?1:2,10===a||2===a){if(10===a){var u=this._parseAACAudio();if(!u)return;var f=u.data,d=u.data.sampleFreq;if(0===u.packetType){r.sampleRate=d,r.channelCount=f.channelCount,r.codec=f.codec,r.manifestCodec=f.manifestCodec,r.config=f.config,r.refSampleDuration=1024/d*r.timeScale,e.hasInitialMetaDispatched?(e.videoTrack.length||e.audioTrack.length)&&this.dataReady(e.videoTrack,e.audioTrack):e.state._audioInitialMetadataDispatched=!0,this.metaDataReady("audio",r);var h=e.mediaInfo;h.audioCodec=r.codec,h.audioSampleRate=r.sampleRate,h.audioChannelCount=r.channelCount,h.audioConfig=r.config,h.hasVideo?h.videoCodec&&(h.mimeType=\'video/x-flv codecs="\'+h.videoCodec+","+h.audioCodec+\'"\',h.codec=h.mimeType.replace("x-flv","mp4")):(h.mimeType=\'video/x-flv codecs="\'+h.audioCodec+\'"\',h.codec=h.mimeType.replace("x-flv","mp4")),h.isComplete&&this.mediaInfoReady(h)}else if(1===u.packetType){var c=e.state.timeStampBase+this.currentTag.getTime(),p={unit:u.data,length:u.data.byteLength,dts:c,pts:c};i.samples.push(p),i.length+=u.data.length}}this.resetStatus()}else this.error("only support AAC Audio format so far")},t.prototype._parseAACAudio=function(){if(!(this.unreadLength<=1)){var t={},e=new Uint8Array(this.data.buffer,this.readOffset,this.unreadLength),i=e[0];if(this.readOffset+=1,t.packetType=i)t.data=e.slice(1);else{var r=this.currentTag,n=r.position,a=r.tagSize;this.store.metaEndPosition=n+Z.readAsInt(a)+4,t.data=this._parseAACAudioSpecificConfig()}return t}},t.prototype._parseAACAudioSpecificConfig=function(){var t,e=new It(this.data.buffer,this),i=It.getAndNum,r={samplingFrequency:null,extAudioObjectType:null,extAudioSamplingIdx:null},n={},a=e.getUint8(),o=e.getUint8(),s=t=a>>>3,u=(a&i(5,7))<<1|o>>>7;if(u<0||yt.length<u)return this.emitError("decoder",{line:"141",handle:"_parseAACAudioSpecificConfig",msg:"invalid samplingFrequencyIndex "+u}),void this.dispatch(mt,"error samplingFrequencyIndex: "+u);r.samplingFrequency=yt[u];var f=r.channelCount=(o&i(1,4))>>>3;if(f<0||7<f)return this.emitError("decoder",{line:"154",handle:"_parseAACAudioSpecificConfig",msg:"invalid Audio Channel Count: "+f}),void this.dispatch(mt,"error Audio Channel Count: "+f);if(5===s){var d=e.getUint8();r.extAudioSamplingIdx=(o&i(5,7))<<1|d>>>7,r.extAudioObjectType=(d&i(1,5))>>>2}return Q.browser===vt?r.extAudioSamplingIdx=6<=u?(s=5,n=new Array(4),u-3):(s=2,n=new Array(2),u):Q.os.isAndroid?(s=2,n=new Array(2),r.extAudioSamplingIdx=u):(s=5,r.extensionSamplingIndex=u,n=new Array(4),6<=u?r.extensionSamplingIdx=u-3:1===f&&(s=2,n=new Array(2),r.extensionSamplingIndex=u)),n[0]=s<<3,n[0]|=(14&u)>>1,n[1]|=(1&u)<<7,n[1]|=f<<3,5===s&&(n[1]|=(14&r.extAudioSamplingIdx)>>1,n[2]=(1&r.extensionSamplingIdx)<<7,n[2]|=8,n[3]=0),{config:n,sampleFreq:r.samplingFrequency,channelCount:f,codec:"mp4a.40."+s,manifestCodec:"mp4a.40."+t}},t.prototype.initAudioMeta=function(t){var e=this.store,i=e.state,r=e.audioTrack;return t.duration=i.duration,t.timeScale=i.timeScale,t.type="audio",t.id=r.id,t},t.prototype.resetStatus=function(){this.currentTag=null,this.data=new Uint8Array(0),this.readOffset=0},Object.defineProperty(t.prototype,"dataSize",{get:function(){return this.data.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unreadLength",{get:function(){return this.dataSize-this.readOffset},enumerable:!0,configurable:!0}),t}(at),Mt=[{name:"duration",type:Boolean,parser:function(t,e){t.mediaInfo.duration=e.duration}},{name:"hasAudio",type:Boolean,parser:function(t,e){t.mediaInfo.hasAudio=e.hasAudio}},{name:"hasVideo",type:Boolean,parser:function(t,e){t.mediaInfo.hasVideo=e.hasVideo}},{name:"audiodatarate",type:Number,parser:function(t,e){t.mediaInfo.audioDataRate=e.audiodatarate}},{name:"videodatarate",type:Number,parser:function(t,e){t.mediaInfo.videoDataRate=e.videodatarate}},{name:"width",type:Number,parser:function(t,e){t.mediaInfo.width=e.width}},{name:"height",type:Number,parser:function(t,e){t.mediaInfo.height=e.height}},{name:"duration",type:Number,parser:function(t,e){if(!t.state.duration){var i=Math.floor(e.duration*t.state.timeScale);t.state.duration=t.mediaInfo.duration=i}},onTypeErr:function(t){t.mediaInfo.duration=0}},{name:"framerate",type:Number,parser:function(t,e){var i=Math.floor(1e3*e.framerate);if(0<i){var r=i/1e3,n=t.referFrameRate,a=t.mediaInfo;n.fixed=!0,n.fps=r,n.fpsNum=i,n.fpsDen=1e3,a.fps=r}}},{name:"keyframes",type:Object,parser:function(t,e){var i=e.keyframes;t.mediaInfo.hasKeyframes=!!i,i&&(t.mediaInfo.keyframes=this._parseKeyframes(i)),e.keyframes=null},onTypeErr:function(t){t.mediaInfo.hasKeyframes=!1}}],Ft=(_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),zt=Object.prototype.hasOwnProperty,Vt=function(i){function t(t){var e=i.call(this,t,"demuxer")||this;return e.CLASS_NAME=e.constructor.name,e._metaDemuxer=new Tt(t),e._videoDemuxer=new Bt(t),e._audioDemuxer=new Et(t),e._firstParse=!0,e._dataOffset=0,e}return Ft(t,i),t.prototype.setEventBind=function(){this._videoDemuxer.dataReady=this.dataReady,this._videoDemuxer.metaDataReady=this.metaDataReady,this._videoDemuxer.mediaInfoReady=this.mediaInfoReady,this._audioDemuxer.dataReady=this.dataReady,this._audioDemuxer.metaDataReady=this.metaDataReady,this._audioDemuxer.mediaInfoReady=this.mediaInfoReady},t.prototype.destroy=function(){this._metaDemuxer=null,this._videoDemuxer=null,this._audioDemuxer=null},t.prototype.resolveTags=function(){var e=this,t=this.store.state.tags,i=this.store,r=i.videoTrack,n=i.audioTrack;t.forEach(function(t){e.resolveTag(t)}),this.store.hasInitialMetaDispatched&&(r.length||n.length)&&this.dataReady(n,r),this.store.state.tags=[]},t.prototype.resolveTag=function(t){switch(String(t.tagType)){case"8":this._resolveAudioTag(t);break;case"9":this._resolveVideoTag(t);break;case"18":this._resolveMetaTag(t)}},t.prototype._resolveAudioTag=function(t){t.bodySize<=1&&this.warn("Not enough data for audio tag body"),this._audioDemuxer.resolve(t)},t.prototype._resolveVideoTag=function(t){if(t.bodySize<=1)this.error("Not enough data for video tag body");else{var e=this.store.state,i=e._hasVideo;e.hasVideoFlagOverrided&&!i||this._videoDemuxer.resolve(t)}},t.prototype._initMetaData=function(t){var a=this,o=this.store;if(zt.call(t,"onMetaData")){o.hasMetaData;var s=(o.metaData=t).onMetaData;Mt.forEach(function(t){var e=t.name,i=t.type,r=t.parser,n=t.onTypeErr;Object(s[e])instanceof i?r.call(a,o,s):n&&n instanceof Function&&n(o)}),this.store.mediaInfo._metaData=t,this.store.mediaInfo.isComplete&&this.mediaInfoReady(this.store.mediaInfo)}},t.prototype._resolveMetaTag=function(t){var e=t.body,i=this._metaDemuxer.resolve(e,e.length);this._initMetaData(i)},t.prototype._parseKeyframes=function(t){for(var e=[],i=[],r=this.store,n=r.videoTimeScale,a=r.state,o=1;o<t.times.length;o++)e[e.length]=a.timeStampBase+Math.floor(t.times[o]*n),i[i.length]=t.filepositions[o];return{times:e,filePositions:i}},t}(at),Nt=function(){function t(t){this._type=t,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),t.prototype.isEmpty=function(){return 0===this._list.length},t.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},t.prototype._searchNearestSegmentBefore=function(t){var e=this._list;if(0===e.length)return-2;var i=e.length-1,r=0,n=0,a=i,o=0;if(t<e[0].originDts)return o=-1;for(;n<=a;){if((r=n+Math.floor((a-n)/2))===i||t>e[r].lastSample.originDts&&t<e[r+1].originDts){o=r;break}e[r].originDts<t?n=r+1:a=r-1}return o},t.prototype._searchNearestSegmentAfter=function(t){return this._searchNearestSegmentBefore(t)+1},t.prototype.append=function(t){var e=this._list,i=this._lastAppendLocation,r=0;-1!==i&&i<e.length&&t.originStartDts>=e[i].lastSample.originDts&&(i===e.length-1||i<e.length-1&&t.originStartDts<e[i+1].originStartDts)?r=i+1:0<e.length&&(r=this._searchNearestSegmentBefore(t.originStartDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,t)},t.prototype.getLastSegmentBefore=function(t){var e=this._searchNearestSegmentBefore(t);return 0<=e?this._list[e]:null},t.prototype.getLastSampleBefore=function(t){var e=this.getLastSegmentBefore(t);return null!==e?e.lastSample:null},t.prototype.getLastRAPBefore=function(t){for(var e=this._searchNearestSegmentBefore(t),i=this._list[e].randomAccessPoints;0===i.length&&0<e;)e--,i=this._list[e].randomAccessPoints;return 0<i.length?i[i.length-1]:null},t}(),Kt=function(){function t(){this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}return t.prototype.addRAP=function(t){t.isRAP=!0,this.randomAccessPoints.push(t)},t}(),Ht=function(){return(Ht=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},qt=function(){function n(t){var r=this,e=n.getDefaultInf();if(!t||"[object Object]"!==Object.prototype.toString.call(t))return e;var i=Ht({},e,t);Object.entries(i).forEach(function(t){var e=t[0],i=t[1];r[e]=i})}return n.getDefaultInf=function(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}},n}(),Gt=(w=function(t){return new Uint8Array([t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)])},S={},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t.reduce(function(t,e){return t+"_"+e},""),r=w.apply(void 0,t);return void 0!==S[i]?S[i]:S[i]=r}),Zt=1,Wt=function(){function p(){}return p.size=function(t){return Z.writeUint32(t)},p.initBox=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var n=new Z;return n.write.apply(n,[p.size(t),Gt(e)].concat(i)),n.buffer},p.extension=function(t,e){return new Uint8Array([t,e>>16&255,e>>8&255,255&e])},p.ftyp=function(){return p.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))},p.moov=function(t){var e=8,i=p.mvhd(t.duration,t.timescale),r=p.videoTrak(t),n=p.audioTrak(t),a=p.mvex(t.duration);return[i,r,n,a].forEach(function(t){e+=t.byteLength}),p.initBox(e,"moov",i,r,n,a)},p.mvhd=function(t,e){var i=e||1e3,r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return p.initBox(8+r.length,"mvhd",new Uint8Array(r))},p.videoTrak=function(t){var e=8,i=p.tkhd({id:1,duration:t.duration,timescale:t.timescale,width:t.width,height:t.height,type:"video"}),r=p.mdia({type:"video",timescale:t.timescale,duration:t.duration,sps:t.sps,pps:t.pps,pixelRatio:t.pixelRatio,width:t.width,height:t.height});return[i,r].forEach(function(t){e+=t.byteLength}),p.initBox(e,"trak",i,r)},p.audioTrak=function(t){var e=8,i=p.tkhd({id:2,duration:t.duration,timescale:t.timescale,width:0,height:0,type:"audio"}),r=p.mdia({type:"audio",timescale:t.timescale,duration:t.duration,channelCount:t.audioChannelCount,samplerate:t.audioSampleRate,config:t.audioConfig});return[i,r].forEach(function(t){e+=t.byteLength}),p.initBox(e,"trak",i,r)},p.tkhd=function(t){var e=t.id,i=t.duration,r=t.width,n=t.height,a=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,n>>>8&255,255&n,0,0]);return p.initBox(8+a.byteLength,"tkhd",a)},p.edts=function(t){var e=new Z,i=t.duration,r=t.mediaTime;return e.write(p.size(36),Gt("edts")),e.write(p.size(28),Gt("elst")),e.write(new Uint8Array([0,0,0,1,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,1])),e.buffer},p.mdia=function(t){var e=8,i=p.mdhd(t.timescale,t.duration),r=p.hdlr(t.type),n=p.minf(t);return[i,r,n].forEach(function(t){e+=t.byteLength}),p.initBox(e,"mdia",i,r,n)},p.mdhd=function(t,e){var i=new Uint8Array([0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e,85,196,0,0]);return p.initBox(12+i.byteLength,"mdhd",p.extension(0,0),i)},p.hdlr=function(t){var e=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(e.splice.apply(e,[8,4].concat([115,111,117,110])),e.splice.apply(e,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),p.initBox(8+e.length,"hdlr",new Uint8Array(e))},p.minf=function(t){var e=8,i="video"===t.type?p.vmhd():p.smhd(),r=p.dinf(),n=p.stbl(t);return[i,r,n].forEach(function(t){e+=t.byteLength}),p.initBox(e,"minf",i,r,n)},p.vmhd=function(){return p.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))},p.smhd=function(){return p.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))},p.dinf=function(){var t=new Z;return t.write(p.size(36),Gt("dinf"),p.size(28),Gt("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer},p.stbl=function(t){var e=8,i=p.stsd(t),r=p.stts(),n=p.stsc(),a=p.stsz(),o=p.stco();return[i,r,n,a,o].forEach(function(t){e+=t.byteLength}),p.initBox(e,"stbl",i,r,n,a,o)},p.stsd=function(t){var e;return e="audio"===t.type?p.mp4a(t):p.avc1(t),p.initBox(16+e.byteLength,"stsd",p.extension(0,0),new Uint8Array([0,0,0,1]),e)},p.mp4a=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),i=p.esds(t.config);return p.initBox(8+e.byteLength+i.byteLength,"mp4a",e,i)},p.esds=function(t){void 0===t&&(t=[43,146,8,0]);var e=t.length,i=new Z,r=new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t).concat([6,1,2]));return i.write(p.size(8+r.byteLength),Gt("esds"),r),i.buffer},p.avc1=function(t){var e=new Z,i=t.sps,r=t.pps,n=t.width,a=t.height,o=t.pixelRatio[0],s=t.pixelRatio[1],u=new Z;u.write(new Uint8Array([1,i[1],i[2],i[3],255,225].concat([i.length>>>8&255,255&i.length]))),u.write(i,new Uint8Array([1,r.length>>>8&255,255&r.length]),r);var f=u.buffer,d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>8&255,255&n,a>>8&255,255&a,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),c=new Uint8Array([o>>24,o>>16&255,o>>8&255,255&o,s>>24,s>>16&255,s>>8&255,255&s]);return e.write(p.size(40+d.byteLength+f.byteLength+h.byteLength),Gt("avc1"),d,p.size(8+f.byteLength),Gt("avcC"),f,p.size(20),Gt("btrt"),h,p.size(16),Gt("pasp"),c),e.buffer},p.stts=function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return p.initBox(16,"stts",t)},p.stsc=function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return p.initBox(16,"stsc",t)},p.stco=function(){var t=new Uint8Array([0,0,0,0,0,0,0,0]);return p.initBox(16,"stco",t)},p.stsz=function(){var t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return p.initBox(20,"stsz",t)},p.mvex=function(t){var e=new Z,i=Z.writeUint32(t);return e.write(p.size(88),Gt("mvex"),p.size(16),Gt("mehd"),p.extension(0,0),i,p.trex(1),p.trex(2)),e.buffer},p.trex=function(t){var e=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return p.initBox(8+e.byteLength,"trex",e)},p.moof=function(t){var e=8,i=p.mfhd(),r=p.traf(t);return[i,r].forEach(function(t){e+=t.byteLength}),p.initBox(e,"moof",i,r)},p.mfhd=function(){var t=Z.writeUint32(Zt);return Zt+=1,p.initBox(16,"mfhd",p.extension(0,0),t)},p.traf=function(t){var e=8,i=p.tfhd(t.id),r=p.tfdt(t.time),n=p.sdtp(t),a=p.trun(t,n.byteLength);return[i,r,n,a].forEach(function(t){e+=t.byteLength}),p.initBox(e,"traf",i,r,n,a)},p.tfhd=function(t){var e=Z.writeUint32(t);return p.initBox(16,"tfhd",p.extension(0,0),e)},p.tfdt=function(t){return p.initBox(16,"tfdt",p.extension(0,0),Z.writeUint32(t))},p.trun=function(e,t){var i=new Z,r=Z.writeUint32(e.samples.length),n=Z.writeUint32(92+16*e.samples.length+t);i.write(p.size(20+16*e.samples.length),Gt("trun"),new Uint8Array([0,0,15,1]),r,n);var a=i.buffer.byteLength,o=0;e.samples.forEach(function(){a+=16});var s=new Uint8Array(a);return s.set(i.buffer,0),o+=i.buffer.byteLength,e.samples.forEach(function(t){s.set(Z.writeUint32(t.duration),o),o+=4,s.set(Z.writeUint32(t.size),o),o+=4,1===e.id?(s.set(Z.writeUint32(t.isKeyframe?33554432:16842752),o),o+=4,s.set(Z.writeUint32(t.cps),o)):(s.set(Z.writeUint32(16777216),o),o+=4,s.set(Z.writeUint32(0),o)),o+=4}),s},p.sdtp=function(e){var i=new Z;return i.write(p.size(12+e.samples.length),Gt("sdtp"),p.extension(0,0)),e.samples.forEach(function(t){i.write(new Uint8Array(1===e.id?[t.key?32:16]:[16]))}),i.buffer},p.mdat=function(t){var e=new Z,i=8;t.samples.forEach(function(t){i+=t.size}),e.write(p.size(i),Gt("mdat"));var r=new Uint8Array(i),n=0;return r.set(e.buffer,n),n+=8,t.samples.forEach(function(t){t.buffer.forEach(function(t){r.set(t.data,n),n+=t.data.byteLength})}),r},p}(),Xt=(A=function(t,e){return(A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Jt=function(r){function n(t){var e=r.call(this,t,"remuxer_")||this;e._dtsBase=0,e._isDtsBaseInited=!1,e._videoMeta=null,e._audioMeta=null,e._audioNextDts=null,e._videoNextDts=null,e._videoSegmentList=new Nt("video"),e._audioSegmentList=new Nt("audio");var i=Q.browser;return e._fillSilenceFrame="ie"===i,e}return Xt(n,r),n.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear(),this._videoSegmentList=null,this._audioSegmentList=null},n.prototype.remux=function(t,e){!this._isDtsBaseInited&&this.calcDtsBase(t,e),this._remuxVideo(e),this._remuxAudio(t)},n.prototype.seek=function(){this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear()},n.prototype.onMetaDataReady=function(t,e){this["_"+t+"Meta"]=e},n.prototype.onMediaInfoReady=function(t){var e=new Z,i=Wt.ftyp(),r=Wt.moov(t);return e.write(i,r),e.buffer},n.prototype.calcDtsBase=function(t,e){var i=1/0,r=1/0;t.samples&&t.samples.length&&(i=t.samples[0].dts),e.samples&&e.samples.length&&(r=e.samples[0].dts),this._dtsBase=Math.min(i,r),this._isDtsBaseInited=!0},n.prototype._remuxVideo=function(t){if(this._videoMeta){var e=t;if(t.samples&&t.samples.length){for(var i,r,n,a=e.samples,o=-1,s=-1,u=[],f={samples:[]},d=new Kt;a.length;){var h=a.shift(),c=h.isKeyframe,p=h.cps,l=h.dts-this._dtsBase;if(void 0===i)if(this._videoNextDts)i=1e3<=l-this._videoNextDts?0:l-this._videoNextDts;else if(this._videoSegmentList.isEmpty())i=0;else{var m=this._videoSegmentList.getLastSegmentBefore(l);if(m){var g=m.lastDts,y=m.gap;i=l-(g+(3<l-(g+y)?l-(g+y):0))}else i=0}var v=l,b=(l-=i)+p;-1===o&&(o=l,s=b);for(var _=[];h.units.length;){var w={buffer:[],size:0},S=h.units.shift();_.push(S),w.buffer.push(S),w.size+=S.data.byteLength,f.samples.push(w)}var A=0;if(1<=a.length)A=a[0].dts-this._dtsBase-i-l;else A=1<=u.length?u[u.length-1].duration:this._videoMeta.refSampleDuration;if(c){var D=new qt({dts:l,pts:b,duration:A,originDts:h.dts,position:h.position,isRAP:!0});d.addRAP(D)}u.push({dts:l,cps:p,pts:b,units:_,size:h.length,isKeyframe:c,duration:A,originDts:v})}var x=u[0],O=u[u.length-1];r=O.dts+O.duration,n=O.pts+O.duration,this._videoNextDts=r,d.startDts=o,d.endDts=r,d.startPts=s,d.endPts=n,d.originStartDts=x.originDts,d.originEndDts=O.originDts+O.duration,d.gap=i;var k=new qt({dts:x.dts,pts:x.pts,duration:x.duration,isKeyframe:x.isKeyframe,originDts:x.originDts}),L=new qt({dts:O.dts,pts:O.pts,duration:O.duration,isKeyframe:O.isKeyframe,originDts:O.originDts});d.firstSample=k,d.lastSample=L;var U=new Z;e.samples=u,e.time=o;var T=Wt.moof(e),P=Wt.mdat(f);U.write(T,P),this.store.isLive||this._videoSegmentList.append(d),e.samples=[],e.length=0,this.mediaFragment({type:"video",data:U.buffer.buffer,sampleCount:u.length,fragment:d})}}},n.prototype._remuxAudio=function(t){if(this._audioMeta){var e,i,r,n=t.samples,a=-1,o=[],s={samples:[]};if(n&&n.length){for(var u=!1;n.length;){var f=n.shift(),d=f.unit,h=f.dts-this._dtsBase,c=!1;if(void 0===e)if(this._audioNextDts)e=1e3<=h-this._audioNextDts?0:h-this._audioNextDts;else if(this._audioSegmentList.isEmpty())e=0;else{var p=this._audioSegmentList.getLastSegmentBefore(h);if(p){var l=p.lastDts,m=p.gap;e=h-(l+(3<h-(l+m)?h-(l+m):0))}else c=this._fillSilenceFrame&&!this._videoSegmentList.isEmpty(),e=0}var g=h;if(h-=e,c){var y=this._videoSegmentList.getLastSampleBefore(g);y&&y.startDts<h?(r=h-y.startDts,h=y.startDts):c=!1}if(u||(a=h,u=!0),c){n.unshift(f);var v=this.initSilentAudio(h,r);o.push(v);var b={buffer:[],size:0};b.buffer.push({data:v.unit}),b.size+=v.unit.byteLength,s.samples.push(b)}else{var _=0;if(1<=n.length)_=n[0].dts-this._dtsBase-e-h;else _=1<=o.length?o[o.length-1].duration:this._audioMeta.refSampleDuration;var w={dts:h,pts:h,cts:0,size:d.byteLength,duration:_,originDts:g},S={buffer:[],size:0};S.buffer.push({data:d}),S.size+=d.byteLength,s.samples.push(S),o.push(w)}}var A=o[o.length-1];i=A.dts+A.duration,this._audioNextDts=i;var D=new Kt;D.startDts=a,D.endDts=i,D.startPts=a,D.endPts=i,D.originStartDts=o[0].originDts,D.originEndDts=A.originDts+A.duration,D.gap=e,D.firstSample=new qt({dts:o[0].dts,pts:o[0].pts,duration:o[0].duration,originDts:o[0].originDts}),D.lastSample=new qt({dts:A.dts,pts:A.pts,duration:A.duration,originDts:A.originDts}),t.samples=o;var x=new Z;t.time=a;var O=Wt.moof(t),k=Wt.mdat(s);x.write(O,k),this.store.isLive||this._audioSegmentList.append(D),t.samples=[],t.length=0,this.mediaFragment({type:"audio",data:x.buffer.buffer,sampleCount:o.length,fragment:D})}}},n.prototype.initSilentAudio=function(t,e){var i=n.getSilentFrame(this._audioMeta.channelCount);return{dts:t,pts:t,cps:0,duration:e,unit:i,size:i.byteLength,originDts:t}},n.getSilentFrame=function(t){return 1===t?new Uint8Array([0,200,0,128,35,128]):2===t?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null},n}(at),Qt=(D=function(t,e){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}D(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Yt=function(i){function t(t){var e=i.call(this)||this;return e.rangeList=[],e._pendingFragments=[],e._pendingRemoveRange=[],e.err_cnt=0,e._tempBaseTime=0,e.firstFlag=!0,e._isNewSegmentsArrival=!1,e.isSeeking=!1,e.isChangingSrc=!1,e.isDataLoading=!1,e.stop=!1,e.config=t,e.META_CHUNK_SIZE=Math.pow(10,6),e.CHUNK_SIZE=Math.pow(10,6),e.requestConfig={mode:e.config.cors?"cors":"same-origin"},e.range={start:-1,end:-1},e._tempBaseTime=0,e._isNewSegmentsArrival=!1,e.store=new Y(e),e.flvParser=new tt(e.store),e.tagDemuxer=new Vt(e.store),e.mp4remuxer=new Jt(e.store),e.buffer=new Z,e.bufferKeyframes=new Set,e.initEventBind(),e.load(),e}return Qt(t,i),t.prototype.load=function(){return this.range={start:this.range.start+1,end:this.range.end+this.META_CHUNK_SIZE},this.loadData()},t.prototype.loadData=function(){var e=this;return this.loadMetaData().then(function(t){e.rangeList.push([e.range.start,e.range.end]),e.resolver(t)}).catch(function(t){3<=e.err_cnt?e.emit("error",t):(e.err_cnt+=1,e.loadData())})},t.prototype.loadMetaData=function(){var t=this.range,e=t.start,i=void 0===e?0:e,r=t.end,n=void 0===r?i+this.META_CHUNK_SIZE:r;return n<i?Promise.reject(""):(this.loadTask=new q(this.config.url,[i,n],this.requestConfig),this.loadTask.promise)},t.prototype.resolver=function(t){var e=t.timeStamp,i=t.buffer;if(e===this.loadTask.timeStamp){this.err_cnt=0,this.buffer.write(new Uint8Array(i));var r=this.setFlv(this.buffer.buffer);this.buffer.buffer=this.buffer.buffer.slice(r),this.store.mediaInfo.isComplete||this.load()}},t.prototype.setFlvFirst=function(t){var e=this.flvParser.setFlv(new Uint8Array(t)),i=this.store.state.tags;if(i.length){if(18!==i[0].tagType)throw new Error("flv file without metadata tag");0!==this._tempBaseTime&&this._tempBaseTime===i[0].getTime()&&(this.store.state._timestampBase=0),this.tagDemuxer.resolveTags()}return this.firstFlag=!1,e},t.prototype.setFlvUsually=function(t){var e=this.flvParser.setFlv(new Uint8Array(t));return this.store.state.tags.length&&this.tagDemuxer.resolveTags(),e},Object.defineProperty(t.prototype,"setFlv",{get:function(){return this.firstFlag?this.setFlvFirst:this.setFlvUsually},enumerable:!0,configurable:!0}),t.prototype.dataReady=function(t,e){this.mp4remuxer.remux(t,e)},t.prototype.mediaInfoReady=function(t){var e=this.mp4remuxer.onMediaInfoReady(t);this.ftyp_moov||(this.ftyp_moov=e,this.emit(P,e))},t.prototype.metaDataReady=function(t,e){this.mp4remuxer.onMetaDataReady(t,e)},t.prototype.newMediaFragment=function(t){this._isNewSegmentsArrival=!0,this.emit(L,t)},t.prototype.initEventBind=function(){this.tagDemuxer.dataReady=this.dataReady.bind(this),this.tagDemuxer.mediaInfoReady=this.mediaInfoReady.bind(this),this.tagDemuxer.metaDataReady=this.metaDataReady.bind(this),this.tagDemuxer.setEventBind(),this.mp4remuxer.mediaFragment=this.newMediaFragment.bind(this)},t.prototype.unbindEvents=function(){var t=function(){};this.tagDemuxer.dataReady=t,this.tagDemuxer.mediaInfoReady=t,this.tagDemuxer.metaDataReady=t,this.tagDemuxer.setEventBind(),this.mp4remuxer.mediaFragment=t},t.prototype.timeUpdate=function(t){var e=this;if(!this.isSeeking){var i=this.config,r=i.minCachedTime,n=i.preloadTime,a=this.store.mediaInfo,o=a.duration,s=a.timeScale,u=t.range||[0,0],f=t.currentTime||0;if(o-u[1]*s<.1*s)return;u[1]-f<r&&!this.isDataLoading&&(this.isDataLoading=!0,this.getNextRange(f,n),this.loadSegments().then(function(){e.isDataLoading=!1}))}},t.prototype.loadSegments=function(){var e=this;this._isNewSegmentsArrival=!1;var t=function(){return e.stop?Promise.reject():e.loadMetaData().then(function(t){e.rangeList.push([e.range.start,e.range.end]),e.resolveChunk(t)}).catch(function(){3<=e.err_cnt?e.emit(j,"加载视频失败"):(e.err_cnt+=1,t())})};return t()},t.prototype.resolveChunk=function(t){if(t.timeStamp===this.loadTask.timeStamp){this.err_cnt=0,this.buffer.write(new Uint8Array(t.buffer));var e=this.setFlv(this.buffer.buffer);this.buffer.buffer=this.buffer.buffer.slice(e),this._isNewSegmentsArrival?this.isSeeking=!1:this.loadSegments()}},t.prototype.resetPosition=function(t,e){var i=t,r=e;return this.rangeList.some(function(t){if(t[0]<=i&&t[1]<=i)return i=t[1]+1,!0}),this.rangeList.some(function(t){if(t[0]<=r&&t[1]<=r)return r=t[0]-1,!0}),{start:i,end:r}},t.prototype.getNextRange=function(t,e){var i=this.store,r=i.keyframes,n=r.times,a=r.filePositions,o=i.videoTimeScale,s=o*t+e*o;s>n[n.length-1]&&(s=a[a.length-1]);for(var u=0,f=n.length-1,d=f;u<=f;){var h=Math.floor((f+u)/2);if(n[h]<=s&&s<=n[h+1]){d=h+1;break}if(u===f){d=h;break}s<n[h]?f=h-1:u=h+1}this.range={start:this.range.end+1,end:a[d]-1}},t.prototype.destroy=function(){this.mp4remuxer.destroy(),this.flvParser.destroy(),this.tagDemuxer.destroy(),this.mp4remuxer=null,this.flvParser=null,this.tagDemuxer=null,this.loadSegments=function(){return null},this.store=null,this.clearBuffer(),this.stop=!0,this.loadTask&&this.loadTask.cancel()},t.prototype.seek=function(t){var e=t.seektTime;this.loadTask.cancel();var i=this.store,r=i.keyframes,n=void 0===r?{}:r,a=e*i.videoTimeScale,o=this.findPosition(a),s=o.start,u=o.end;this.isSeeking?this.store.clearTags():this.isSeeking=!0,this._pendingFragments=[],this.mp4remuxer.seek(),this.flvParser.seek(),this.loadTask.clear(),this.range={start:n.filePositions[s],end:n.filePositions[u]-1||""},this.buffer=new Z,this.loadSegments()},t.prototype.findPosition=function(t){for(var e=this.store,i=e.keyframes,r=void 0===i?{}:i,n=e.videoTimeScale,a=Math.min(r.filePositions.length,r.times.length),o=this.config.preloadTime,s=0,u=a-1,f=s,d=u;s<u;){var h=Math.floor((s+u)/2),c=r.times[h],p=r.times[h+1];if(c<=t&&t<=p){for(o=o*n+c,d=(f=h)+1;d<a-1&&!(r.times[d]>o);d++);break}t<c?u=h:s=h+1}return{start:f,end:d}},t.prototype.clearBuffer=function(){this._pendingFragments=[],this._pendingRemoveRange=[]},t.prototype.pause=function(){},t.prototype.resume=function(){},t}(et),$t=void 0,te=self,ee=null;te.addEventListener("message",function(t){var e=t.data.sign,i=t.data.config;switch(e){case F:(ee=new Yt(i)).on(x,function(t,e){te.postMessage({msg:x,data:{type:t,info:e}})}.bind($t)),ee.on(O,function(t,e){te.postMessage({msg:O,data:{type:t,info:e}})}.bind($t)),ee.on(k,function(t){var e={msg:k,data:t};te.postMessage(e,[t.data])}.bind($t)),ee.on(L,function(t){var e={msg:L,data:t};te.postMessage(e,[t.data])}.bind($t)),ee.on(U,function(){var t={msg:U};te.postMessage(t)}.bind($t)),ee.on(T,function(){var t={msg:T};te.postMessage(t)}.bind($t)),ee.on(P,function(t){var e={msg:P,data:t};te.postMessage(e)}.bind($t)),ee.on(C,function(t){var e={msg:C,data:t};te.postMessage(e)}.bind($t)),ee.on(I,function(t){var e={data:t,msg:I};te.postMessage(e)}.bind($t)),ee.on(R,function(t){var e={msg:R,data:t};te.postMessage(e)}.bind($t)),ee.on(B,function(t){te.postMessage({msg:B,data:t})}.bind($t));break;case"destroy":ee&&(ee.destroy(),ee=null),te.postMessage({msg:"destroyed"});break;case"seek":ee.seek(t.data.param);break;case"pause":ee.pause();break;case"resume":ee.resume();break;case M:ee.timeUpdate(i);break;case E:ee.seek(i)}})}]);',null)}},function(t,e,i){var n=i(2);"string"==typeof n&&(n=[[t.i,n,""]]);var r={attrs:{"data-injector":"kwe-nav"},singleton:!0,hmr:!0,transform:void 0,insertInto:void 0};i(4)(n,r);n.locals&&(t.exports=n.locals)},function(t,e,i){(t.exports=i(3)(!1)).push([t.i,"body,div,html,input,li,ol,p,textarea,ul{margin:0;padding:0}img{border:0}li{list-style:none outside none}a,a:active,a:hover,a:link,a:link:hover,a:visited{text-decoration:none}.kwe{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around;width:100%;height:100%;line-height:2}",""])},function(t,e){t.exports=function(i){var a=[];return a.toString=function(){return this.map(function(t){var e=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var r=(a=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),o=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[i].concat(o).concat([r]).join("\n")}var a;return[i].join("\n")}(t,i);return t[2]?"@media "+t[2]+"{"+e+"}":e}).join("")},a.i=function(t,e){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},n=0;n<this.length;n++){var r=this[n][0];"number"==typeof r&&(i[r]=!0)}for(n=0;n<t.length;n++){var o=t[n];"number"==typeof o[0]&&i[o[0]]||(e&&!o[2]?o[2]=e:e&&(o[2]="("+o[2]+") and ("+e+")"),a.push(o))}},a}},function(t,e,n){var i,r,o,u={},f=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=i.apply(this,arguments)),r}),a=(o={},function(t,e){if("function"==typeof t)return t();if(void 0===o[t]){var i=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}o[t]=i}return o[t]}),c=null,d=0,s=[],p=n(5);function h(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=u[n.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](n.parts[o]);for(;o<n.parts.length;o++)r.parts.push(b(n.parts[o],e))}else{var a=[];for(o=0;o<n.parts.length;o++)a.push(b(n.parts[o],e));u[n.id]={id:n.id,refs:1,parts:a}}}}function l(t,e){for(var i=[],n={},r=0;r<t.length;r++){var o=t[r],a=e.base?o[0]+e.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};n[a]?n[a].parts.push(s):i.push(n[a]={id:a,parts:[s]})}return i}function m(t,e){var i=a(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=s[s.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),s.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=a(t.insertAt.before,i);i.insertBefore(e,r)}}function y(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=s.indexOf(t);0<=e&&s.splice(e,1)}function g(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var i=function(){0;return n.nc}();i&&(t.attrs.nonce=i)}return v(e,t.attrs),m(t,e),e}function v(e,i){Object.keys(i).forEach(function(t){e.setAttribute(t,i[t])})}function b(e,t){var i,n,r,o,a,s;if(t.transform&&e.css){if(!(o="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=o}if(t.singleton){var u=d++;i=c||(c=g(t)),n=S.bind(null,i,u,!1),r=S.bind(null,i,u,!0)}else r=e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(a=t,s=document.createElement("link"),void 0===a.attrs.type&&(a.attrs.type="text/css"),a.attrs.rel="stylesheet",v(s,a.attrs),m(a,s),n=function(t,e,i){var n=i.css,r=i.sourceMap,o=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||o)&&(n=p(n));r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var a=new Blob([n],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,i=s,t),function(){y(i),i.href&&URL.revokeObjectURL(i.href)}):(i=g(t),n=function(t,e){var i=e.css,n=e.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,i),function(){y(i)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else r()}}t.exports=function(t,a){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(a=a||{}).attrs="object"==typeof a.attrs?a.attrs:{},a.singleton||"boolean"==typeof a.singleton||(a.singleton=f()),a.insertInto||(a.insertInto="head"),a.insertAt||(a.insertAt="bottom");var s=l(t,a);return h(s,a),function(t){for(var e=[],i=0;i<s.length;i++){var n=s[i];(r=u[n.id]).refs--,e.push(r)}t&&h(l(t,a),a);for(i=0;i<e.length;i++){var r;if(0===(r=e[i]).refs){for(var o=0;o<r.parts.length;o++)r.parts[o]();delete u[r.id]}}}};var _,w=(_=[],function(t,e){return _[t]=e,_.filter(Boolean).join("\n")});function S(t,e,i,n){var r=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=w(e,r);else{var o=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=e.protocol+"//"+e.host,o=r+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var i,n=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(n)?t:(i=0===n.indexOf("//")?n:0===n.indexOf("/")?r+n:o+n.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(t,e,i){"use strict";var r=window.URL||window.webkitURL;t.exports=function(e,i){try{try{var n;try{(n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),n=n.getBlob()}catch(t){n=new Blob([e])}return new Worker(r.createObjectURL(n))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(t){if(!i)throw Error("Inline worker is not supported");return new Worker(i)}}},function(t,e,i){"use strict";i.r(e);var n=function(e){var i=this.constructor;return this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){return i.reject(t)})})},r=setTimeout;function o(){}function a(t){if(!(this instanceof a))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],p(t,this)}function s(i,n){for(;3===i._state;)i=i._value;0!==i._state?(i._handled=!0,a._immediateFn(function(){var t=1===i._state?n.onFulfilled:n.onRejected;if(null!==t){var e;try{e=t(i._value)}catch(t){return void f(n.promise,t)}u(n.promise,e)}else(1===i._state?u:f)(n.promise,i._value)})):i._deferreds.push(n)}function u(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof a)return e._state=3,e._value=t,void c(e);if("function"==typeof i)return void p((n=i,r=t,function(){n.apply(r,arguments)}),e)}e._state=1,e._value=t,c(e)}catch(t){f(e,t)}var n,r}function f(t,e){t._state=2,t._value=e,c(t)}function c(t){2===t._state&&0===t._deferreds.length&&a._immediateFn(function(){t._handled||a._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)s(t,t._deferreds[e]);t._deferreds=null}function d(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i}function p(t,e){var i=!1;try{t(function(t){i||(i=!0,u(e,t))},function(t){i||(i=!0,f(e,t))})}catch(t){if(i)return;i=!0,f(e,t)}}a.prototype.catch=function(t){return this.then(null,t)},a.prototype.then=function(t,e){var i=new this.constructor(o);return s(this,new d(t,e,i)),i},a.prototype.finally=n,a.all=function(e){return new a(function(n,r){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var o=Array.prototype.slice.call(e);if(0===o.length)return n([]);var a=o.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if("function"==typeof i)return void i.call(t,function(t){s(e,t)},r)}o[e]=t,0==--a&&n(o)}catch(t){r(t)}}for(var t=0;t<o.length;t++)s(t,o[t])})},a.resolve=function(e){return e&&"object"==typeof e&&e.constructor===a?e:new a(function(t){t(e)})},a.reject=function(i){return new a(function(t,e){e(i)})},a.race=function(r){return new a(function(t,e){for(var i=0,n=r.length;i<n;i++)r[i].then(t,e)})},a._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){r(t,0)},a._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console};var h=a,l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype.finally||(l.Promise.prototype.finally=n):l.Promise=h;i(1);var m,y,g,v,b=function(){function t(){this.__eeOnce__={},this.__ee__={}}return t.prototype.on=function(t,e){return this.addEvents(this.__ee__,t,e),this},t.prototype.once=function(t,e){this.addEvents(this.__eeOnce__,t,e)},t.prototype.off=function(i,n){var r=this,o=this.__ee__[i],a=this.__eeOnce__[i];return o&&0<o.length&&o.forEach(function(t,e){t===n&&(r.__ee__[i]=o.splice(e,1))}),a&&0<a.length&&a.forEach(function(t,e){t===n&&(r.__eeOnce__[i]=a.splice(e,1))}),this},t.prototype.emit=function(i){for(var n=this,r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var e=this.__ee__[i],o=this.__eeOnce__[i];e&&0<e.length&&e.forEach(function(t){"function"==typeof t&&t.apply(void 0,r)}),o&&0<o.length&&o.forEach(function(t,e){"function"==typeof t&&(t.apply(void 0,r),n.__eeOnce__[i]=o.splice(e,1))})},t.prototype.destroy=function(){this.__ee__={},this.__eeOnce__={}},t.prototype.addEvents=function(t,e,i){t[e]?t[e].push(i):t[e]=[i]},t}(),_="io_error",w="demux_error",S="init_segment",A="media_segment",O="loading_complete",D="recovered_early_eof",E="media_info",x="metadata_arrived",k="scriptdata_arrived",P="statistics_info",T="recommend_seekpoint",U="error",L="sourceopen",j="sourceclose",C="updateend",R={PLAY:"play",PLAYING:"playing",PAUSE:"pause",ENDED:"ended",SEEKING:"seeking",SEEKED:"seeked",TIMEUPDATE:"timeupdate",WATING:"waiting",CANPLAY:"canplay",THROUGH:"canplaythrough",DURATION_CHANGE:"durationchange",VOLUME_CHANGE:"volumechange",LOADED_DATA:"loadeddata"},B="init",I=(m=function(t,e){return(m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}m(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),M=0,F=function(n){function t(t,e){void 0===e&&(e='video/mp4; codecs="avc1.64001E, mp4a.40.5"');var i=n.call(this)||this;return i.config=t,i.count=M++,i.codecs=e,"MediaSource"in window&&MediaSource.isTypeSupported(i.codecs)&&(i.mediaSource=new window.MediaSource,i.url=window.URL.createObjectURL(i.mediaSource),i.handleSourceOpen=i.onSourceOpen.bind(i),i.globalEvents()),i}return I(t,n),t.prototype.globalEvents=function(){var t=this;this.mediaSource.addEventListener(L,this.handleSourceOpen),this.mediaSource.addEventListener(j,function(){t.emit(j)})},Object.defineProperty(t.prototype,"state",{get:function(){return this.mediaSource.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.mediaSource.duration},set:function(t){this.mediaSource.duration=t},enumerable:!0,configurable:!0}),t.prototype.onSourceOpen=function(){var e=this;this.sourceBuffer=this.mediaSource.addSourceBuffer(this.codecs),this.sourceBuffer.addEventListener(U,function(t){e.emit(U,{type:"sourceBuffer",error:t})}),this.sourceBuffer.addEventListener(C,function(){e.emit(C)}),this.emit(L)},t.prototype.appendBuffer=function(t){var e=this.sourceBuffer;if(!1===e.updating&&"open"===this.state)return e.appendBuffer(t),!0;if("closed"===this.state)this.emit(U,{type:"sourceBuffer",error:new Error("mediaSource is not attached to video or mediaSource is closed")});else{if("ended"!==this.state)return!0===e.updating&&this.emit("warn",{type:"sourceBuffer",error:new Error("mediaSource is busy")}),!1;this.emit(U,{type:"sourceBuffer",error:new Error("mediaSource is closed")})}},t.prototype.destroy=function(){this.mediaSource.removeEventListener(L,this.handleSourceOpen),this.destroy(),this.mediaSource=null,this.endOfStream()},t.prototype.removeBuffer=function(t,e){this.sourceBuffer.remove(t,e)},t.prototype.endOfStream=function(){"open"===this.mediaSource.readyState&&this.mediaSource.endOfStream()},t.isSupported=function(t){return window.MediaSource&&window.MediaSource.isTypeSupported(t)},t}(b),N=function(n,t,r,e){void 0===n&&(n="div"),void 0===t&&(t=""),void 0===r&&(r={}),void 0===e&&(e="");var o=document.createElement(n);return o.className=e,o.innerHTML=t,Object.keys(r).forEach(function(t){var e=t,i=r[t];"video"===n||"audio"===n?i&&o.setAttribute(e,i):o.setAttribute(e,i)}),o},z=function(t,e){return void 0===t&&(t=document),t.querySelector(e)},V=function(e,i){void 0===i&&(i=1e3);var n=0;return function(){var t=Date.now();(i<t-n||!n)&&(e(),n=t)}},G=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),Z=function(i){function t(t){var e=i.call(this,t)||this;return e.isSeeking=!1,e.config=t,e.url&&e.init(),e}return G(t,i),t.prototype.init=function(){this.ev=Object.keys(R),this._mediaElement=N("video","",{controls:"controls"});var t=z(document,""+this.config.id);t.classList.add(this.config.prefix),this._mediaElement.src=this.url,t.appendChild(this._mediaElement),this.mediaEvents()},t.prototype.mediaEvents=function(){var i=this,n=this.timeUpdate();this.ev.forEach(function(e){i._mediaElement.addEventListener(R[e],function(t){switch(R[e]){case R.CANPLAY:i.canPlay(t);break;case R.SEEKING:i.seeking(t);break;case R.SEEKED:i.isSeeking=!1;break;case R.TIMEUPDATE:n()}})})},t.prototype.destroy=function(){},t.prototype.canPlay=function(t){if(this.config.autoplay){var e=this._mediaElement.play();e&&e.catch(function(){})}},t.prototype.timeUpdate=function(){var t=this;return V(function(){t.emit(R.TIMEUPDATE,{range:t.getBufferedRange(),currentTime:t.currentTime})})},t.prototype.seeking=function(t){this.isBuffered()||this.seekable&&(this.emit(R.SEEKING,{seektTime:this._mediaElement.currentTime}),this.isSeeking=!0)},t.prototype.isBuffered=function(t){void 0===t&&(t=0);var e=this._mediaElement,i=e.buffered,n=e.currentTime,r=!1;if(i.length)for(var o=0,a=i.length;o<a;o++)if(n>i.start(o)&&n+t<i.end(o)){r=!0;break}return r},t.prototype.getBufferedRange=function(){var t=[0,0],e=this._mediaElement,i=e.buffered,n=e.currentTime;if(i)for(var r=0,o=i.length;r<o&&(t[0]=i.start(r),t[1]=i.end(r),!(t[0]<=n&&n<=t[1]));r++);return t[0]-n<=0&&n-t[1]<=0?t:[0,0]},Object.defineProperty(t.prototype,"autoplay",{get:function(){return this._mediaElement.autoplay},set:function(t){this._mediaElement.autoplay=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crossOrigin",{get:function(){return this._mediaElement.crossOrigin},set:function(t){this._mediaElement.crossOrigin=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSrc",{get:function(){return this._mediaElement.currentSrc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._mediaElement.currentTime},set:function(t){this._mediaElement.currentTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultMuted",{get:function(){return this._mediaElement.defaultMuted},set:function(t){this._mediaElement.defaultMuted=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ended",{get:function(){return this._mediaElement.ended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"error",{get:function(){var t=this._mediaElement.error;if(!t)return null;return[{en:"MEDIA_ERR_ABORTED",cn:"取回过程被用户中止"},{en:"MEDIA_ERR_NETWORK",cn:"当下载时发生错误"},{en:"MEDIA_ERR_DECODE",cn:"当解码时发生错误"},{en:"MEDIA_ERR_SRC_NOT_SUPPORTED",cn:"不支持音频/视频"}][t.code-1].en},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._mediaElement.loop},set:function(t){this._mediaElement.loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(t){this._mediaElement.muted=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"networkState",{get:function(){return[{en:"NETWORK_EMPTY",cn:"音频/视频尚未初始化"},{en:"NETWORK_IDLE",cn:"音频/视频是活动的且已选取资源，但并未使用网络"},{en:"NETWORK_LOADING",cn:"浏览器正在下载数据"},{en:"NETWORK_NO_SOURCE",cn:"未找到音频/视频来源"}][this._mediaElement.networkState].en},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._mediaElement.paused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playbackRate",{get:function(){return this._mediaElement.playbackRate},set:function(t){this._mediaElement.playbackRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"played",{get:function(){return this._mediaElement.played},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preload",{get:function(){return this._mediaElement.preload},set:function(t){this._mediaElement.preload=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return[{en:"HAVE_NOTHING",cn:"没有关于音频/视频是否就绪的信息"},{en:"HAVE_METADATA",cn:"关于音频/视频就绪的元数据"},{en:"HAVE_CURRENT_DATA",cn:"关于当前播放位置的数据是可用的，但没有足够的数据来播放下一帧/毫秒"},{en:"HAVE_FUTURE_DATA",cn:"当前及至少下一帧的数据是可用的"},{en:"HAVE_ENOUGH_DATA",cn:"可用数据足以开始播放"}][this._mediaElement.readyState]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"seekable",{get:function(){return this._mediaElement.seekable},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this._mediaElement.src},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(t){this._mediaElement.volume=t},enumerable:!0,configurable:!0}),t}(F),H=i(0),K=i.n(H),W=(g=function(t,e){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),q=function(){return(q=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},$=function(i){function t(t){var e=i.call(this)||this;return e._pendingRemoveRange=[],e.err_cnt=0,e._tempBaseTime=0,e.firstFlag=!0,e._isNewSegmentsArrival=!1,e.pendingFragments=[],e.isSeeking=!1,e.isAppendBuffer=!1,e.isChangingSrc=!1,e._pendingSeekTime=0,e._workerDestroying=!1,e.config=t,e.video=new Z(t),e.init(),e.globalEvents(),e}return W(t,i),t.prototype.init=function(){},t.prototype.globalEvents=function(){var e=this;this.video.on(L,function(){e.onSourceOpen()}),this.video.on(U,function(t){}),this.video.on(R.TIMEUPDATE,function(t){e._worker.postMessage({sign:R.TIMEUPDATE,config:t})}),this.video.on(R.SEEKING,function(t){e._worker.postMessage({sign:R.SEEKING,config:t})}),this.handleSeekEnd=function(){e.isSeeking=!1},this.handleError=function(t){},this.once(E,function(t){e.handleFtypMoov(t)})},t.prototype.onSourceOpen=function(){var e=this;this.load(),this.video.on(C,function(){if(e.isAppendBuffer=!1,e.pendingFragments.length){var t=e.pendingFragments.shift();e.video.appendBuffer(t.data)}})},t.prototype.load=function(){var e=this;this._worker=new K.a,this._worker.postMessage({sign:B,config:this.config}),this._worker.onmessage=function(t){e._onWorkerMessage(t)}},t.prototype.handleMediaFragment=function(t){this.isAppendBuffer?this.pendingFragments.push(t):(this.isAppendBuffer=!0,this.video.appendBuffer(t.data))},t.prototype.handleFtypMoov=function(t){this.isAppendBuffer=!0,this.video.appendBuffer(t.buffer),this._mediaInfo=t},t.prototype.isEnded=function(){},t.prototype._onWorkerMessage=function(t){var e=t.data,i=e.data,n=e.msg;if("destroyed"===n||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(n){case S:case A:this.handleMediaFragment(i);break;case O:case D:this.emit(n);break;case E:this.emit(n,i);break;case x:case k:case P:this.emit(n,i);break;case _:case w:this.emit(n,i.type,i.info);break;case T:this.emit(n,i)}},t.prototype.play=function(){return this.video._mediaElement.play()},t.prototype.pause=function(){this.video._mediaElement.pause()},Object.defineProperty(t.prototype,"buffered",{get:function(){return this.video._mediaElement.buffered},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.video._mediaElement.duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this.video._mediaElement.volume},set:function(t){this.video._mediaElement.volume=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this.video._mediaElement.muted},set:function(t){this.video._mediaElement.muted=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this.video._mediaElement?this.video._mediaElement.currentTime:0},set:function(t){this.video._mediaElement?this._internalSeek(t):this._pendingSeekTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mediaInfo",{get:function(){return q({},this._mediaInfo)},enumerable:!0,configurable:!0}),t.prototype._internalSeek=function(t){this._pendingSeekTime=t},t}(b),Y=(v=function(t,e){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}v(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),J=function(){return(J=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},Q=function(i){function t(t){var e=i.call(this)||this;return e.config=J({prefix:"kwe-player",isLive:!1,autoplay:!1,chunkSize:0,cors:"",minCachedTime:10,preloadTime:20},t),e.init(),e.globalEvents(),e}return Y(t,i),t.prototype.init=function(){this.flvPlayer=new $(this.config)},t.prototype.globalEvents=function(){},t}(b),X={name:"wePlayer",version:"0.0.0",hash:"559e2c4",branch:"master",lastModefied:"2019-04-07T06:47:54.993Z"};i.d(e,"WEPlayer",function(){return tt});var tt=function(t){t.metadata=X,new Q(t)}}])});